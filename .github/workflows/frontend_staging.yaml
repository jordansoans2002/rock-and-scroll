name: Deploy frontend to staging

on:
  push:
    branches:
      - staging
    paths: 
      - "frontend/**"
      - "shared/**"
      - ".github/workflows/frontend_staging.yaml"

jobs:
  deploy-frontend-to-staging:
    runs-on: stage

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: pnpm install --no-frozen-lockfile

      - name: Build frontend
        run: pnpm build:frontend --mode staging
      
      - name: Deploy to S3
        run: |
          aws s3 sync frontend/dist/ s3://rock-and-scroll-staging/ \
          --delete \
          --cache-control "public,max-age=31536000,immutable" \
          --exclude "index.html"

          aws s3 cp frontend/dist/index.html s3://rock-and-scroll-staging/index.html \
          --cache-control "no-cache,no-store,must-revalidate" \
          --content-type "text/html"
